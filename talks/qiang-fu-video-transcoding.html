<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Video Transcoding in Browser using WebAssembly/WebCodecs - Qiang Fu - W3C/SMPTE Joint Workshop on Professional Media Production on the Web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../talk-ui.css">
    <link rel="stylesheet" href="https://www.w3.org/2019/09/TPAC-template/fonts/iconmonstr-iconic-font.css">
    <meta name="twitter:site" content="@w3c">
    <meta name="twitter:card" content="player">
    <meta property="og:title" content="Video Transcoding in Browser using WebAssembly/WebCodecs by Qiang Fu (Bilibili)">
    <meta property="og:description" content="Introduce some possible ways for web developers to do video-transcoding based on WebAssembly and WebCodecs, and the chance if we could make video-transcoding easier to achieve by WebCodecs APIs.">
    <meta property="og:image" content="thumbnails/qiang-fu-video-transcoding.jpg">
    <meta property="og:video" content="https://iframe.videodelivery.net/d1cd0c00c28f4d4b507ee9219b19227d">
    <meta property="twitter:player" content="https://iframe.videodelivery.net/d1cd0c00c28f4d4b507ee9219b19227d?defaultTextTrack=en">
    <meta property="twitter:player:width" content="360">
    <meta property="twitter:player:height" content="202">
  </head>
  <body>
    <form id=form><!-- form to request a page in kiosk mode --></form>
    <header id="header" class="header">
      <div id="banner">
        <div>
          <p>
            <a href="https://www.w3.org/"><img alt="W3C" src=
            "../media/w3c_home_nb-v.svg" height="48" width="72"></a>
            <a href="https://www.smpte.org/"><img alt="SMPTE" src=
            "../media/smpte_logo.png" height="48"></a>
          </p>
          <div class="banner-title">
            <h1>
              W3C/SMPTE Joint Workshop on Professional Media Production on the Web
            </h1>
          </div>
          <p class="attribution">
            <span>Timeline photo by <a href="https://unsplash.com/@kineticbear?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Jacob Miller</a> on <a href="https://unsplash.com/s/photos/timeline?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></span>
          </p>
          <p>8-19 November 2021; online event</p>
        </div>
      </div>
      <nav class="menu" id="menu">
        <ul>
          <li><a href="../">Call for Participation</a></li>
          <li><a href="../talks.html">Pre-recorded talks</a></li>
          <li><a href="../agenda.html">Live sessions</a></li>
          <li><a href="../report.html">Report</a></li>
        </ul>
      </nav>
    </header>
    <main id="main" class="main talk">
      <section id="intro">
        <h2>Video Transcoding in Browser using WebAssembly/WebCodecs</h2>

        <p class="talkinfo">
          Presenter: <strong>Qiang Fu (Bilibili)</strong><br>
          Duration: <strong>6 minutes</strong><br>
          Slides: <a href="slides/qiang-fu-video-transcoding.pdf"><strong>PDF</strong></a>
        </p>

        <p class="buttons">
          <!-- previousStart -->
          <button form="form" type="submit" class="picto im-angle-left" formaction="sergio-garcia-murillo-whip.html">
            Previous: It's time to WHIP WebRTC into shape
          </button>
          <!-- previousEnd -->
          <a href="../talks.html" class="picto im-data">All talks</a>
          <!-- nextStart -->
          <button form="form" type="submit" formaction="patrick-brosset-eyedropper-api.html">
            Next: The EyeDropper API<span class="picto im-angle-right"></span>
          </button>
          <!-- nextEnd -->
        </p>
      </section>

      <section id="talk">
        <h3 style="display:none">Slides &amp; video</h3>

        <details>
          <summary>Keyboard shortcuts in the video player</summary>
          <ul>
            <li>Play/pause: <kbd>space</kbd>
            </li><li>Increase volume: <kbd>up arrow</kbd>
            </li><li>Decrease volume: <kbd>down arrow</kbd>
            </li><li>Seek forward: <kbd>right arrow</kbd>
            </li><li>Seek backward: <kbd>left arrow</kbd>
            </li><li>Captions on/off: <kbd>C</kbd>
            </li><li>Fullscreen on/off: <kbd>F</kbd>
            </li><li>Mute/unmute: <kbd>M</kbd>
            </li><li>Seek to 0%, 10%â€¦ 90%: <kbd>0-9</kbd>
          </li></ul>
        </details>

        <div id="player">
          <script type="application/ld+json">
            {
              "@context": "https://schema.org",
              "@type": "VideoObject",
              "name": "Video Transcoding in Browser using WebAssembly/WebCodecs",
              "description": "Introduce some possible ways for web developers to do video-transcoding based on WebAssembly and WebCodecs, and the chance if we could make video-transcoding easier to achieve by WebCodecs APIs.",
              "thumbnailUrl": "thumbnails/qiang-fu-video-transcoding.jpg",
              "duration": "PT5M34S",
              "embedUrl": "https://iframe.videodelivery.net/d1cd0c00c28f4d4b507ee9219b19227d",
            }
          </script>

          <iframe id="video" title="Video Transcoding in Browser using WebAssembly/WebCodecs" src="https://iframe.videodelivery.net/d1cd0c00c28f4d4b507ee9219b19227d"
            allow="accelerometer; autoplay; encrypted-media; picture-in-picture"
            allowfullscreen="" width="640" height="360" frameborder="0"></iframe>

          
    <div class="related">
      <p>Related conversations on <a href="https://github.com/w3c/media-production-workshop/issues">GitHub</a>:</p>
      <ul>
        <li><a href="https://github.com/w3c/media-production-workshop/issues/35">(De-)Muxing API for WebCodecs</a> (#35)</li>
      </ul>
    </div>

          <div id="slides" class="fade-in" role="region" aria-live="off" aria-label="Slide container">
            <div id="ts-1"><i-slide src="slides/qiang-fu-video-transcoding.pdf#1" class="slide">Slide 1 of 8</i-slide>
<div>
  <p id="tp-1">Hello everyone. I'm Qiang Fu from Bilibili group. My topic is video transcoding in web browsers.</p>
  <p id="tp-2">I will introduce several feasible ways to achieve the goal and provide a suggestion for Web API to make video transcoding easier for web developers.</p>
  <p id="tp-3">Bilibili is based in China and our application provides video content for users. You may think of it as YouTube in China.</p>
  <p id="tp-4">Okay. Now let's begin.</p>
</div>

</div><div id="ts-2"><i-slide src="slides/qiang-fu-video-transcoding.pdf#2" class="slide">Slide 2 of 8</i-slide>
<div>
  <p id="tp-5">Why we need to focus on the topic? To guide a new way using browsers, we need it.</p>
  <p id="tp-6">The first thing is about video preview. Some video formats like AVI or FLV cannot be played directly by HTML. Yes. We can implement a player by WebAssembly or JavaScript for these videos but what if we transcode them to MP4 or WebM format, then we can use a video tag to play in HTML. It is simple.</p>
  <p id="tp-7">The other thing related to the details about media production. For some videos, only small adjustments are required. We could offer help to change to change the resolution and frame rate or some other parameters of a video to meet the (?) for uploading. Our goal is to get a new way to, via transcoding.</p>
</div>

</div><div id="ts-3"><i-slide src="slides/qiang-fu-video-transcoding.pdf#3" class="slide">Slide 3 of 8</i-slide>
<div>
  <p id="tp-8">The basic steps for transcoding can be concluded as the following: passing the input file to a demuxer to get to the streams and encoded video chunks. Then passing the video chunks to a decoder to get the video frame. Then maybe we need to perform some operations on the frame. After passing it the opposite way, finally we get the output file.</p>
  <p id="tp-9">I summarized the process for ffmpeg, but how can we use it in browser?</p>
</div>

</div><div id="ts-4"><i-slide src="slides/qiang-fu-video-transcoding.pdf#4" class="slide">Slide 4 of 8</i-slide>
<div>
  <p id="tp-10">There is a popular way for web developers to experience video transcoding. WebAssembly can help. After compiling the source code of ffmpeg to WebAssembly, run it in a browser and give it a command, we get the video we need. that's really simple at first sight.</p>
  <p id="tp-11">But WebAssembly looks like a black box and developers don't care about the inner details. Let's see how it works.</p>
</div>

</div><div id="ts-5"><i-slide src="slides/qiang-fu-video-transcoding.pdf#5" class="slide">Slide 5 of 8</i-slide>
<div>
  <p id="tp-12">Although WebAssembly is a black box, we still need some preparations. First of all, familiarity with ffmpeg. Then we need to study how EMScripten works and the best basic design concepts. The last step is to run WebAssembly in browsers.</p>
  <p id="tp-13">After you finish the steps and get to demo a few common questions will be there. Why it is so slow, why the same command can give such huge difference on performance between browsers and OS. How could I make it faster?</p>
  <p id="tp-14">The answer is tough. WebAssembly has done improvements, just like supporting SIMD and multi-threads. To enjoy these new features, we usually check the configure of EMScripten and ffmpeg. And luckily the source coder of ffmpeg should be modified. It is really professional and tough for web developers.</p>
</div>

</div><div id="ts-6"><i-slide src="slides/qiang-fu-video-transcoding.pdf#6" class="slide">Slide 6 of 8</i-slide>
<div>
  <p id="tp-15">Let's talk about this other way where we can divide the process of transcoding into different parts. Each part may have a unique solution.</p>
  <p id="tp-16">For example, the demuxer and muxer can be realized by JavaScript, encoder and decoder can use WebCodecs API simply. The video frame can be drawn on canvas or WebGL.</p>
  <p id="tp-17">Tested in an integrated way, everything looks fine. We splice each part like Lego blocks.</p>
  <p id="tp-18">I searched the GitHub for some repositories. Finally, I could transcode the video in the integrated way. The demuxer and decoders are integrated as a video player. To reduce the size of WebAssembly. I imported some libraries for ffmpeg and derived some files. The output of the player is video frames in RGB or YUV format. I pass it to WebCodecs API to get the encoded video chunk. Then the chunks flow through a muxer for making video in WebM for watching. Finally I got the local video I need. Sounds perfect.</p>
</div>

</div><div id="ts-8"><i-slide src="slides/qiang-fu-video-transcoding.pdf#8" class="slide">Slide 8 of 8</i-slide>
<div>
  <p id="tp-19">So integrated way seems flexible enough. I could even change the frame in canvas by JavaScript, just like what filters do in ffmpeg. WebCodecs is cool. And it has option for hardware acceleration. The developers don't need to focus on the details.</p>
  <p id="tp-20">The only concern is the muxer. Every muxer is different and I have to collect solutions for supporting MP4, WebM and other formats independently. It takes a lot of time.</p>
</div>

</div><div id="ts-9"><i-slide src="slides/qiang-fu-video-transcoding.pdf#9" class="slide">Slide 9 of 8</i-slide>
<div>
  <p id="tp-21">What if an official muxer API is provided, that's my suggestion. Its design can follow the WebCodecs.</p>
  <p id="tp-22">The Web will get the following benefits. First, it will complete the roadmap of media processing in browsers. And if we want to popularize some video formats, like WebM, we should reduce the difficulty for producing them.</p>
  <p id="tp-23">The most valuable thing for me is to provide a better coding experience. The source code of ffmpeg is really tough and you need a lot of time to become a real expert. That's all my contents. Thank you for watching.</p>
</div>

</div>
          </div>
        </div>
      </section>

      <section id="extrabuttons">
        <p class="buttons">
          <!-- previousStart -->
          <button form="form" id="prevtalk" type="submit" formaction="sergio-garcia-murillo-whip.html" class="picto im-angle-left">Previous: It's time to WHIP WebRTC into shape</button>
          <!-- previousEnd -->
          <a id="alltalks" href="../talks.html" class="picto im-data">All talks</a>
          <!-- nextStart -->
          <button form="form" id="nexttalk" type="submit" formaction="patrick-brosset-eyedropper-api.html">Next: The EyeDropper API<span class="picto im-angle-right"></span></button>
          <!-- nextEnd -->
        </p>
      </section>

      <section id="sponsors">
        <h2>
          Workshop sponsor
        </h2>
        <p><a href="https://www.adobe.com/"><img src="../media/adobe.png" alt="Adobe" width="70"></a></p>
        <p class="small">Interested in sponsoring the workshop?<br/>Please check the <a href="sponsors.html">sponsorship package</a>.</p>
      </section>
    </main>
    <footer class="footer" id="footer">
      <p>
        W3C is proud to be an open and inclusive organization, focused on
        productive discussions and actions. Our <a href=
        "https://www.w3.org/Consortium/cepc/">Code of Ethics and Professional
        Conduct</a> ensures that all voices can be heard.
      </p>
      <p>Questions? Contact FranÃ§ois Daoust
        &lt;<a href="mailto:fd@w3.org">fd@w3.org</a>&gt;.
      </p>
      <p>
        Suggestions for improving this workshop page, such as fixing typos or
        adding specific topics, can be made by opening a <a href=
        "https://github.com/w3c/media-production-workshop/">pull request on
        GitHub</a>, or by emailing FranÃ§ois Daoust
        &lt;<a href="mailto:fd@w3.org">fd@w3.org</a>&gt;.
      </p>
    </footer>
    <script src="../script.js"></script>
    <script>
      let captions = [
  {
    "language": "en",
    "label": "English",
    "src": "captions/qiang-fu-video-transcoding.vtt",
    "mode": "hidden",
    "cues": [],
    "activeCues": [
      {
        "text": ""
      }
    ]
  },
  {
    "language": "zh-hans",
    "label": "ç®€ä½“ä¸­æ–‡",
    "src": "captions/zh/qiang-fu-video-transcoding.vtt",
    "mode": "hidden",
    "cues": [],
    "activeCues": [
      {
        "text": ""
      }
    ]
  }
];
    </script>
    <script src="https://www.w3.org/2019/09/TPAC-template/parser.js"></script>
    <script src="https://embed.videodelivery.net/embed/sdk.latest.js"></script>
    <script src="../talk-sync.js"></script>
    <script src="https://w3c.github.io/i-slide/i-slide.js" type="module"></script>
  </body>
</html>
