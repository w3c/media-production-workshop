<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Hello WebCodecs - Chris Cunningham - W3C/SMPTE Joint Workshop on Professional Media Production on the Web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../talk-ui.css">
    <link rel="stylesheet" href="https://www.w3.org/2019/09/TPAC-template/fonts/iconmonstr-iconic-font.css">
    <meta name="twitter:site" content="@w3c">
    <meta name="twitter:card" content="player">
    <meta property="og:title" content="Hello WebCodecs by Chris Cunningham (Google)">
    <meta property="og:description" content="This talk offers a real time coding demo to familiarize viewers with the core interfaces of WebCodecs. The demo will demux, decode, and render video from an mp4.">
    <meta property="og:image" content="thumbnails/chris-cunningham-hello-webcodecs.jpg">
    <meta property="og:video" content="https://iframe.videodelivery.net/b985442d8c3162143bb845dc791528cf">
    <meta property="twitter:player" content="https://iframe.videodelivery.net/b985442d8c3162143bb845dc791528cf?defaultTextTrack=en">
    <meta property="twitter:player:width" content="360">
    <meta property="twitter:player:height" content="202">
  </head>
  <body>
    <form id=form><!-- form to request a page in kiosk mode --></form>
    <header id="header" class="header">
      <div id="banner">
        <div>
          <p>
            <a href="https://www.w3.org/"><img alt="W3C" src=
            "../media/w3c_home_nb-v.svg" height="48" width="72"></a>
            <a href="https://www.smpte.org/"><img alt="SMPTE" src=
            "../media/smpte_logo.png" height="48"></a>
          </p>
          <div class="banner-title">
            <h1>
              W3C/SMPTE Joint Workshop on Professional Media Production on the Web
            </h1>
          </div>
          <p class="attribution">
            <span>Timeline photo by <a href="https://unsplash.com/@kineticbear?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Jacob Miller</a> on <a href="https://unsplash.com/s/photos/timeline?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></span>
          </p>
          <p>8-19 November 2021; online event</p>
        </div>
      </div>
      <nav class="menu" id="menu">
        <ul>
          <li><a href="../">Call for Participation</a></li>
          <li><a href="../talks.html">Pre-recorded talks</a></li>
          <li><a href="../agenda.html">Live sessions</a></li>
          <li><a href="../report.html">Report</a></li>
        </ul>
      </nav>
    </header>
    <main id="main" class="main talk">
      <section id="intro">
        <h2>Hello WebCodecs</h2>

        <p class="talkinfo">
          Presenter: <strong>Chris Cunningham (Google)</strong><br>
          Duration: <strong>11 minutes</strong><br>
          Slides: <a href="slides/chris-cunningham-hello-webcodecs.pdf"><strong>PDF</strong></a>
        </p>

        <p class="buttons">
          <!-- previousStart -->
          <button form="form" type="submit" class="picto im-angle-left" formaction="ed-gray-accessibility.html">
            Previous: Accessibility in creative tools discussion
          </button>
          <!-- previousEnd -->
          <a href="../talks.html" class="picto im-data">All talks</a>
          <!-- nextStart -->
          <button form="form" type="submit" formaction="chris-cunningham-webcodecs-videoencoderconfig.html">
            Next: WebCodecs VideoEncoderConfig<span class="picto im-angle-right"></span>
          </button>
          <!-- nextEnd -->
        </p>
      </section>

      <section id="talk">
        <h3 style="display:none">Slides &amp; video</h3>

        <details>
          <summary>Keyboard shortcuts in the video player</summary>
          <ul>
            <li>Play/pause: <kbd>space</kbd>
            </li><li>Increase volume: <kbd>up arrow</kbd>
            </li><li>Decrease volume: <kbd>down arrow</kbd>
            </li><li>Seek forward: <kbd>right arrow</kbd>
            </li><li>Seek backward: <kbd>left arrow</kbd>
            </li><li>Captions on/off: <kbd>C</kbd>
            </li><li>Fullscreen on/off: <kbd>F</kbd>
            </li><li>Mute/unmute: <kbd>M</kbd>
            </li><li>Seek to 0%, 10%â€¦ 90%: <kbd>0-9</kbd>
          </li></ul>
        </details>

        <div id="player">
          <script type="application/ld+json">
            {
              "@context": "https://schema.org",
              "@type": "VideoObject",
              "name": "Hello WebCodecs",
              "description": "This talk offers a real time coding demo to familiarize viewers with the core interfaces of WebCodecs. The demo will demux, decode, and render video from an mp4.",
              "thumbnailUrl": "thumbnails/chris-cunningham-hello-webcodecs.jpg",
              "duration": "PT11M23S",
              "embedUrl": "https://iframe.videodelivery.net/b985442d8c3162143bb845dc791528cf",
            }
          </script>

          <iframe id="video" title="Hello WebCodecs" src="https://iframe.videodelivery.net/b985442d8c3162143bb845dc791528cf"
            allow="accelerometer; autoplay; encrypted-media; picture-in-picture"
            allowfullscreen="" width="640" height="360" frameborder="0"></iframe>

          
    <div class="related">
      <p>Related conversations on <a href="https://github.com/w3c/media-production-workshop/issues">GitHub</a>:</p>
      <ul>
        <li><a href="https://github.com/w3c/media-production-workshop/issues/59">Advanced use cases for WebCodecs</a> (#59)</li>
      </ul>
    </div>

          <div id="slides" class="fade-in" role="region" aria-live="off" aria-label="Slide container">
            <div id="ts-1"><i-slide src="slides/chris-cunningham-hello-webcodecs.pdf#1" class="slide">Slide 1 of 7</i-slide>
<div>
  <p id="tp-1">Hi, I'm Chris Cunningham. I am the tech lead for WebCodecs effort in Chrome and a co-editor on the spec.</p>
  <p id="tp-2">This talk is going to be a primer on the API. If you have already seen the API and played with it a little bit, or if you saw my talk at IIT earlier this week, you can skip this one.</p>
  <p id="tp-3">I am going to do a talk about video encoder configuration, and I do encourage everybody to check that one out.</p>
  <p id="tp-4">You're probably already familiar with existing codecs APIs, like ffmpeg, AVFoundation, MediaCodec, and WebCodecs is similar to those.</p>
  <p id="tp-5">Those libraries have been a dependency of the browser for years in support of the video tag and WebRTC. And with WebCodecs, we're exposing those and others in a unified manner directly to JavaScript.</p>
</div>

</div><div id="ts-2"><i-slide src="slides/chris-cunningham-hello-webcodecs.pdf#2" class="slide">Slide 2 of 7</i-slide>
<div>
  <p id="tp-6">Let's look at a typical decoder flow.</p>
  <p id="tp-7">In this graphic the large blue square is WebCodecs, and the diagram shows chunks of encoded video coming from network or storage, heading into the decoder, being decoded to these video frames, and then coming out where they are rendered to canvas or media stream track.</p>
  <p id="tp-8">We can use all these pieces together without writing a ton of code. And I think that's a good way to kind of get familiar with the API. Let's do that now.</p>
</div>

</div><div id="ts-3"><i-slide src="slides/chris-cunningham-hello-webcodecs.pdf#3" class="slide">Slide 3 of 7</i-slide>
<div>
  <p id="tp-9">I am going to share my screen, bear with me. Right. All right, so before I start coding, I want to show you what we're going to build.</p>
  <p id="tp-10">Big Buck Bunny, of course, being demuxed from an MP4 file, then decoded and rendered to canvas, all using WebCodecs.</p>
  <p id="tp-11">And I should point out that on the recording, it was just being done with Google Hangouts. You're probably seeing some stutter and some chop. And that is just the nature of recording using Hangouts. Locally, this is a smooth playback. Every frame is rendered. It's not being dropped. It's a little bit faster than the native playback rate for this file. And that's just because we're painting every frame as soon as it comes out of the decoder.</p>
  <p id="tp-12">Right. Let me show you where we are now. We have a blank canvas. Let's pull open the code. Alright. Like I said, we have a simple blank canvas and then I'm using MP4Box.js to do the demuxing of the MP4 file. That's why I'm pulling it here.</p>
  <p id="tp-13">And then we open up the script tag and I bring in an MP4 demuxer module, which is really just a wrapper around MP4Box.js. And there's some interesting stuff in there, but none of it really uses WebCodecs. I'm just gonna skip over it, and feel free to check it out on GitHub.</p>
  <p id="tp-14">All you need to know here is that it opens up the file for me and sort of populates the basic track info structure that I need telling me about width and height, and video, and it's codec details, etc.</p>
  <p id="tp-15">All right, then I grabbed the canvas element, set its dimensions according to what was found in the MP4. And I grabbed the context because I'm going to use that to paint video frames, shortly.</p>
  <p id="tp-16">Let's make a paintFrame function. All right, we're going to call it context.drawImage passing in frame at the origin and using the canvas width and height (inaudible.)</p>
  <p id="tp-17">Now that we're done rendering the frame, we're gonna call frame.close().</p>
  <p id="tp-18">A few things to talk about here. One, we were able to call drawImage like this because frame, VideoFrame, is a CanvasImageSource. And that means you can use it here, but also with a texImage2D, createImageBitmap anywhere that image source is accepted.</p>
  <p id="tp-19">Also we call frame.close() right away because we want to release the memory that backs that frame back to the browser for recycling and reuse. VideoFrame objects and the audio analog, which is called AudioData, are just lightweight JavaScript objects. But they hold references to heavier memory like actual pixel data or GPU buffers, typically pooled resources inside the browser. You want to call close on these objects as soon as you're done with them, so that the browser can reuse them, especially in the case of decoding because the decoder actually owns those pool resources. Returning them to the decoder prevents the decoder from stalling.</p>
  <p id="tp-20">Okay. We've got our paintFrame. Let's make a decoder.</p>
  <p id="tp-21">The constructor takes two callbacks. The first is an output callback, which we'll bring from above, the second is an error callback which you should use to do some kind of fallback handling, show a message to the user. In our case, this is just a demo, so, we'll just log it.</p>
  <p id="tp-22">All right. Now that we've got the decoder, we need to make a configuration. The required parameters here are going to be a codec string, which if you've used MediaSource or video canPlayType, MediaCapabilities, any of these APIs is the familiar codec string. For H264, this is a AVC1.1, profile bytes, level bytes. In our case, the demuxer has found those for us, so we're just going to call trackInfo.codec.</p>
  <p id="tp-23">But then we also need the description. If you are familiar with FFmpeg, this is the extradata. For those of you familiar with h.264 and MP4 files, this is the AVCC atom. Generically, this is a sequence of codec specific bytes that is used to prepare the decoder for the stream that's about to decode.</p>
  <p id="tp-24">You can find more details about the description and the codec string in the codec registry in the WebCodecs spec. There we have the codec string for each codec and whether the description is required and if it is required, what its details are. In our case, like I said, it comes from the AVCC atom. The demuxer has already found it for us. I'll just plop it in there.</p>
  <p id="tp-25">All right, before we can use the configuration, we just check that the configuration is actually supported. Like any media API in the web support for a given codec, and the details of this configuration is going to vary by platform, by browser. It's important to first check before we try to use it.</p>
  <p id="tp-26">We're going to call VideoDecoder.isConfigSupported passing in the config. And then we're going to get the results of that.</p>
  <p id="tp-27">Here's where you would check: is it supported? And if not implement some sort of fallback plan, maybe you use WASM. Maybe you choose a different codec. This is a demo. I'm just going to say: assert that it is a supported.</p>
  <p id="tp-28">Okay, now that we know we can grab and configure the decoder.</p>
  <p id="tp-29">And now it's just time to start feeding the decoder with chunks to decode. We're going to say demuxer, give me the video stream, happens to be track zero, and then we're going to give a callback. For every chunk, please call decoder.decode, passing up that chunk.</p>
  <p id="tp-30">A few things to point out. There was no waiting here. When we called configure, we didn't wait for that to complete, before we started calling decode. When we called decode, We don't wait for the first decode to complete before we call the second decode.</p>
  <p id="tp-31">It's a fire and forget kind of a queued processing model under the hood. A decode that follows the configure is presumed to use the configuration that followed it in the configure. That preceded it in the configure. And then you can queue up as much work as you want.</p>
  <p id="tp-32">Alright, that should do it. Let's see if I have any typos.</p>
  <p id="tp-33">All right. There you have it, Big Buck Bunny, decoding and rendering.</p>
</div>

</div><div id="ts-4"><i-slide src="slides/chris-cunningham-hello-webcodecs.pdf#4" class="slide">Slide 4 of 7</i-slide>
<div>
  <p id="tp-34">We didn't talk at all about audio, but here in the slides, I'm going to link to the same demo basically, but with an audio playout that is synchronized to the video, and then this will also be a link to the GitHub code to make that work. The short of it is uses AudioDecoder, but instead of a canvas, you're going to use AudioWorklet to do the rendering. Just one option that you have, you could also use like AudioBufferSourceNode. If you're going to do just kind of like smaller chunks of audio, or MediaStreamTrack if you are doing kind of a real time scenario.</p>
</div>

</div><div id="ts-5"><i-slide src="slides/chris-cunningham-hello-webcodecs.pdf#5" class="slide">Slide 5 of 7</i-slide>
<div>
  <p id="tp-35">All right, let's talk a little bit about audio decoding.</p>
  <p id="tp-36">Here is the AudioDecoder interface. I didn't even show the VideoDecoder interface. They're basically the same.</p>
  <p id="tp-37">The things to point out are instead of outputting, a VideoFrame, AudioDecoder is going to output an AudioData object, which is conceptually just a buffer of PCM samples. Otherwise it's the same five methods, same two attributes, same constructor same semantics.</p>
  <p id="tp-38">Two methods we didn't get to when we talked about video, which are present in both interfaces are flush and reset.</p>
  <p id="tp-39">Flush is going to force the codec to flush the pipeline of all completed work. As it's going to admit any outputs that might've been ready, but haven't quite made it to the output callback yet. You might use this in an end of stream scenario where you have fed the decoder with all the things you need to give it, but you wanna make sure that you get like the last frame out.</p>
  <p id="tp-40">The other one that we didn't talk about is reset. Reset is going to completely reset the codec. It's going to drop all active work, all queued work. It's going to drop the active configuration, just everything. You would use this if you would do like a seek. And so the user said stop where you are. I'm going to go to this other point in the timeline, start there instead.</p>
</div>

</div><div id="ts-6"><i-slide src="slides/chris-cunningham-hello-webcodecs.pdf#6" class="slide">Slide 6 of 7</i-slide>
<div>
  <p id="tp-41">Okay. That was decoding. Let's talk a little bit about encoding.</p>
  <p id="tp-42">The flow is pretty much the same, but in reverse. Frames go in, they get encoded, they produce chunks.</p>
  <p id="tp-43">The encoder interfaces are nearly identical to those from decode. You swap decode for encode, but otherwise it's the same five methods you saw in the last slide. And then audio and coding also follows this exact same pattern.</p>
</div>

</div><div id="ts-7"><i-slide src="slides/chris-cunningham-hello-webcodecs.pdf#7" class="slide">Slide 7 of 7</i-slide>
<div>
  <p id="tp-44">At this point, you've had a glance at all the core interfaces and the relationships to each other. And that's kind of the gist. That's the primer on WebCodecs. As a reminder, I have another talk coming up for VideoEncoder configuration, please check that out.</p>
</div>

</div>
          </div>
        </div>
      </section>

      <section id="extrabuttons">
        <p class="buttons">
          <!-- previousStart -->
          <button form="form" id="prevtalk" type="submit" formaction="ed-gray-accessibility.html" class="picto im-angle-left">Previous: Accessibility in creative tools discussion</button>
          <!-- previousEnd -->
          <a id="alltalks" href="../talks.html" class="picto im-data">All talks</a>
          <!-- nextStart -->
          <button form="form" id="nexttalk" type="submit" formaction="chris-cunningham-webcodecs-videoencoderconfig.html">Next: WebCodecs VideoEncoderConfig<span class="picto im-angle-right"></span></button>
          <!-- nextEnd -->
        </p>
      </section>

      <section id="sponsors">
        <h2>
          Workshop sponsor
        </h2>
        <p><a href="https://www.adobe.com/"><img src="../media/adobe.png" alt="Adobe" width="70"></a></p>
        <p class="small">Interested in sponsoring the workshop?<br/>Please check the <a href="sponsors.html">sponsorship package</a>.</p>
      </section>
    </main>
    <footer class="footer" id="footer">
      <p>
        W3C is proud to be an open and inclusive organization, focused on
        productive discussions and actions. Our <a href=
        "https://www.w3.org/Consortium/cepc/">Code of Ethics and Professional
        Conduct</a> ensures that all voices can be heard.
      </p>
      <p>Questions? Contact FranÃ§ois Daoust
        &lt;<a href="mailto:fd@w3.org">fd@w3.org</a>&gt;.
      </p>
      <p>
        Suggestions for improving this workshop page, such as fixing typos or
        adding specific topics, can be made by opening a <a href=
        "https://github.com/w3c/media-production-workshop/">pull request on
        GitHub</a>, or by emailing FranÃ§ois Daoust
        &lt;<a href="mailto:fd@w3.org">fd@w3.org</a>&gt;.
      </p>
    </footer>
    <script src="../script.js"></script>
    <script>
      let captions = [
  {
    "language": "en",
    "label": "English",
    "src": "captions/chris-cunningham-hello-webcodecs.vtt",
    "mode": "hidden",
    "cues": [],
    "activeCues": [
      {
        "text": ""
      }
    ]
  }
];
    </script>
    <script src="https://www.w3.org/2019/09/TPAC-template/parser.js"></script>
    <script src="https://embed.videodelivery.net/embed/sdk.latest.js"></script>
    <script src="../talk-sync.js"></script>
    <script src="https://w3c.github.io/i-slide/i-slide.js" type="module"></script>
  </body>
</html>
