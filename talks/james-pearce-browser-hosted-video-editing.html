<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Browser Hosted Video Editing - James Pearce - W3C/SMPTE Joint Workshop on Professional Media Production on the Web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="https://www.w3.org/2021/10/TPAC/talk-ui.css">
    <link rel="stylesheet" href="https://www.w3.org/2019/09/TPAC-template/fonts/iconmonstr-iconic-font.css">
    <meta name="twitter:site" content="@w3c">
    <meta name="twitter:card" content="summary_large_image">
    <meta property="og:title" content="Browser Hosted Video Editing by James Pearce (Grass Valley)">
    <meta property="og:description" content="Initially using WebAssembly to run cross compiled codecs, we have just ported to using WebCodecs instead. The talk discusses the impact of WebCodecs for Browser Hosted Video Editing and how WebCodecs interacts with the wider browser development environment.">
    <meta property="og:image" content="thumbnails/james-pearce-browser-hosted-video-editing.jpg">
  </head>
  <body>
    <form id=form><!-- form to request a page in kiosk mode --></form>
    <header id="header" class="header">
      <div id="banner">
        <div>
          <p>
            <a href="https://www.w3.org/"><img alt="W3C" src=
            "../media/w3c_home_nb-v.svg" height="48" width="72"></a>
            <a href="https://www.smpte.org/"><img alt="SMPTE" src=
            "../media/smpte_logo.png" height="48"></a>
          </p>
          <div class="banner-title">
            <h1>
              W3C/SMPTE Joint Workshop on Professional Media Production on the Web
            </h1>
          </div>
          <p class="attribution">
            <span>Timeline photo by <a href="https://unsplash.com/@kineticbear?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Jacob Miller</a> on <a href="https://unsplash.com/s/photos/timeline?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></span>
          </p>
          <p>9-18 November 2021; online event</p>
        </div>
      </div>
      <nav class="menu" id="menu">
        <ul>
          <li>
            <a href="../">Call for Participation</a>
          </li>
          <li>
            <a href="../talks.html">Talks</a>
          </li>
          <li>
            <a href="../speakers.html">Apply as a speaker</a>
          </li>
        </ul>
      </nav>
    </header>
    <main id="main" class="main talk">
      <section id="intro">
        <h2>Browser Hosted Video Editing</h2>

        <p class="talkinfo">
          Presenter: <strong>James Pearce (Grass Valley)</strong><br>
          Duration: <strong>10 minutes</strong><br>
          Slides: <a href="null"><strong>download</strong></a>
        </p>

        <p class="buttons">
          <!-- previousStart -->
          <button form="form" type="submit" class="picto im-angle-left" formaction="kevin-streeter-creative-expression.html">
            Previous: Bringing Desktop-Class Creative Expression to the Web
          </button>
          <!-- previousEnd -->
          <a href="../talks.html" class="picto im-data">All talks</a>
          <!-- nextStart -->
          <button form="form" type="submit" formaction="junyue-cao-non-linear-video-editor.html">
            Next: A Non-linear Video Editor built with WebAssembly<span class="picto im-angle-right"></span>
          </button>
          <!-- nextEnd -->
        </p>
      </section>

      <section id="talk">
        <h3 style="display:none">Slides &amp; video</h3>

        <details>
          <summary>Keyboard shortcuts in the video player</summary>
          <ul>
            <li>Play/pause: <kbd>space</kbd>
            </li><li>Increase volume: <kbd>up arrow</kbd>
            </li><li>Decrease volume: <kbd>down arrow</kbd>
            </li><li>Seek forward: <kbd>right arrow</kbd>
            </li><li>Seek backward: <kbd>left arrow</kbd>
            </li><li>Captions on/off: <kbd>C</kbd>
            </li><li>Fullscreen on/off: <kbd>F</kbd>
            </li><li>Mute/unmute: <kbd>M</kbd>
            </li><li>Seek to 0%, 10%… 90%: <kbd>0-9</kbd>
          </li></ul>
        </details>

        <div id="player">
          <script type="application/ld+json">
            {
              "@context": "https://schema.org",
              "@type": "VideoObject",
              "name": "Browser Hosted Video Editing",
              "description": "Initially using WebAssembly to run cross compiled codecs, we have just ported to using WebCodecs instead. The talk discusses the impact of WebCodecs for Browser Hosted Video Editing and how WebCodecs interacts with the wider browser development environment.",
              "thumbnailUrl": "thumbnails/james-pearce-browser-hosted-video-editing.jpg",
              "duration": "PT9M57S",
              "embedUrl": "todo",
            }
          </script>

          <iframe id="video" title="Browser%20Hosted%20Video%20Editing" src="todo"
            allow="accelerometer; autoplay; encrypted-media; picture-in-picture"
            allowfullscreen="" width="640" height="360" frameborder="0"></iframe>

          <div id="slides" class="fade-in" role="region" aria-live="off" aria-label="Slide container">
            <div>
  <p>This is our web-based editor, and for those that aren't familiar with editing, this follows the fairly standard approach that editing applications have, which is a normal three window layout. At the top left, we have a source viewer, which is used to load in source clips, and cut them up, and add them to the timeline. At the bottom. We have a timeline view, which just shows us our various tracks, and segments in those tracks, and in the top right, we have a sequence player, which lets me scrub through, and play through the edit that I'm building, that timeline that I'm building in the view below. On the left, the far left, we have just a view of all our assets in the system, so that lets us find a source, and load it into the source viewer, or just drag it into the timeline.</p>
  <p>This editor, it's pretty much fully featured, in the sense that we've gonna have arbitrary numbers of tracks, arbitrary numbers of segments. We can have effects on those segments. We can have transitions between those segments. You know, I could add a blur to a particular segment, and that will give me a blurred view of that, and I've got some controls that I can use to tweak how blurry that is.</p>
  <p>We have a whole bunch of effects that we've implemented, but, obviously, that list will grow as we build on user requirements.</p>
  <p>In terms of transitions, as well, we have a variety, based on feedback from users, so I could add a simple circle wipe, if I play through that. And again, controls to adjust what that transition does.</p>
  <p>That's in terms of some of the richer stuff that I can add to the timeline, that's a brief summary.</p>
  <p>In terms of playback as well, we have, obviously, pretty high performance scrubbing here, so I can scrub around on the timeline and see the cuts, and the transitions, and all the effects being rendered into that sequence viewer. I can play through, I can play through at different speeds, so I can...
(video audio distorts) Playing at one and a half times there, and we're getting audio, as well. (video audio speeds up) As I play faster and faster, at some point, the audio stops, because it becomes unusable. And that works in reverse, as well. (video audio plays in reverse) I can review a section of the material, just by going backwards and forwards.</p>
  <p>I can move through by frame, as well. And if you can hear, you get chirps, to tell me... (video audio plays back in chirps) You know, where I am in the audio. If I'm looking for a particular point in the presenter's speech, I'm looking for final p", or a final "s", I can hear that by just frame-stepping through.</p>
  <p>This is just a demonstration of quite good performance we're getting, from the media playback, both audio and video.</p>
  <p>To talk about the technologies that are underpinning that, and the APIs we're using, I guess, the primary one that is probably of most interest to this meeting, is WebCodecs, and we're using WebCodecs to decode both H264 and AAC.</p>
  <p>Previous to WebCodecs, we were using WebAssembly, so we built our own decoders, we compiled those with WebAssembly, and we were using those in a Web Worker to decode the material, buffer that, and then have that available for this rapid, random access that we need in the player.</p>
  <p>Because of the way we built our playback engine, we were able to, pretty quickly, swap out the WebAssembly decoders with the WebCodec ones. We get the same kind of the code hasn't changed very much, but their performance has improved significantly, and also, power consumption, and sort of associated, elements of performance that we see improvements in.</p>
  <p>That's been really good. I mentioned previously, Web Workers, as well. For the most part, we're trying to perform our entire decode and render pipeline in a Worker.</p>
  <p>And for the most part, we can do that, where off-screen canvases are available, we can do the entire end-to-end video decode and video rendering in a Worker.</p>
  <p>Audio is a little bit more problematic, because the Web Audio API, most of that API is tied to the main UI thread, which has caused us some problems, historically. We've had to jump through a few hoops to try and buffer as much as possible, so that playback isn't effected by if I start scrolling through the list over here, and cause a significant load on the UI thread. We want to avoid having kind of pauses in the video, or pauses in the playback, as the audio can't be decoded in time.</p>
  <p>Web Audio is one of the areas that have caused us problems. We've got a solution that works for us, but I think, in the future, we'd like to see a solution that, perhaps, pushes the Web Audio API on to a background Worker, if possible.</p>
  <p>We're also using WebGL for the compositing, for the transitions, for the effects, anything that really involves that rendering the video to the screen. And the nice thing about WebGL, as well, because it's a standard, the shader language is standard, we can share that shader code with our render engine.</p>
  <p>And that means that when the final timeline gets rendered out to a high res form, the render engine is able to use those same shaders to generate the same result that we're seeing in this in this low quality, this proxy, browse-quality media, that we're rendering to the screen, here.</p>
  <p>I think that covers the main primary APIs that we're using. To summarize, we're using WebCodecs, we fall back to WebAssembly, still, where WebCodecs aren't available, and we're still using WebAssembly to perform parsing of the MP4 files that we need to, to kind of de-multiplex the elementary streams.</p>
  <p>We're using Web Audio APIs, that's the one that we'd like to see move to the Web Workers, and we're using WebGL, and then various other long-standing APIs that tie the whole thing together.</p>
  <p>I think that pretty much covers what I wanted to talk about. I don't know, James, if you had any questions, or you wanted me to go back and cover anything else in more detail?</p>
  <p>Yes, thanks, James. One thing I'm interested in, is how you manage memory buffers, and manage their lifetimes? You get frames coming out of the codec, what happens with them?</p>
  <p>The buffers we keep tend to be centered around the current position, so we have a cursor, as you can see, here, on the screen. What we try and do is predict, given the what the user is doing, what we want to buffer, and how long we want to buffer for. If the user's playing forwards at 1x, then we tend to kind of weight the buffering on the forwards direction. We'll primarily buffer frames, ahead of the current cursor position, and we'll more aggressively discard buffers that have been played and are behind the current cursor position.</p>
  <p>If we're playing backwards, we'll flip that round, so we're trying to buffer ahead, but we're always buffering a few at least a few frames, either side of that cursor, and in some cases a second or two around that cursor, because we don't know, we can't predict that the user's not going to stop playing and suddenly reverse, so we do need to be able to change direction pretty quickly.</p>
  <p>And that gives us the ability to do this, where we're jogging up and down, and playing backwards and forwards. (video audio distorts) You know, if I'm reviewing a frame, I can skip backwards and forwards.</p>
  <p>We can do that, because we are maintaining a buffer around that current cursor position. We can't, obviously, buffer huge amounts, we're constrained by what is both achievable in the browser and what is reasonable. If I was to just seek to another position on the timeline, that invalidates everything we've buffered, and we have to go and fetch again, but we'll build up a new set of buffered frames again, based on that cursor position.</p>
  <p>Does that answer the question?</p>
  <p>Yes, I think it does, and I think we should stop there.</p>
  <p>Okay.</p>
</div>


          </div>
        </div>
      </section>

      <section id="extrabuttons">
        <p class="buttons">
          <!-- previousStart -->
          <button form="form" id="prevtalk" type="submit" formaction="kevin-streeter-creative-expression.html" class="picto im-angle-left">Previous: Bringing Desktop-Class Creative Expression to the Web</button>
          <!-- previousEnd -->
          <a id="alltalks" href="../talks.html" class="picto im-data">All talks</a>
          <!-- nextStart -->
          <button form="form" id="nexttalk" type="submit" formaction="junyue-cao-non-linear-video-editor.html">Next: A Non-linear Video Editor built with WebAssembly<span class="picto im-angle-right"></span></button>
          <!-- nextEnd -->
        </p>
      </section>

      <section id="sponsors">
        <h2>
          Workshop sponsor
        </h2>
        <p><a href="https://www.adobe.com/"><img src="../media/adobe.png" alt="Adobe" width="70"></a></p>
        <p class="small">Interested in sponsoring the workshop?<br/>Please check the <a href="sponsors.html">sponsorship package</a>.</p>
      </section>
    </main>
    <footer class="footer" id="footer">
      <p>
        W3C is proud to be an open and inclusive organization, focused on
        productive discussions and actions. Our <a href=
        "https://www.w3.org/Consortium/cepc/">Code of Ethics and Professional
        Conduct</a> ensures that all voices can be heard.
      </p>
      <p>Questions? Contact François Daoust
        &lt;<a href="mailto:fd@w3.org">fd@w3.org</a>&gt;.
      </p>
      <p>
        Suggestions for improving this workshop page, such as fixing typos or
        adding specific topics, can be made by opening a <a href=
        "https://github.com/w3c/media-production-workshop/">pull request on
        GitHub</a>, or by emailing François Daoust
        &lt;<a href="mailto:fd@w3.org">fd@w3.org</a>&gt;.
      </p>
    </footer>
    <script src="../script.js"></script>
    <script>
      let captions = [
  {
    "language": "en",
    "label": "English",
    "src": "captions/james-pearce-browser-hosted-video-editing.vtt",
    "mode": "hidden",
    "cues": [],
    "activeCues": [
      {
        "text": ""
      }
    ]
  }
];
    </script>
    <script src="https://www.w3.org/2019/09/TPAC-template/parser.js"></script>
    <script src="https://embed.videodelivery.net/embed/sdk.latest.js"></script>
    <script src="https://www.w3.org/2019/09/TPAC-template/talk-sync.js"></script>
    <script src="https://w3c.github.io/i-slide/i-slide.js" type="module"></script>
  </body>
</html>
