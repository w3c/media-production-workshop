<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Distributed multi-party media-rich content review - Oleg Sidorkin - W3C/SMPTE Joint Workshop on Professional Media Production on the Web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../talk-ui.css">
    <link rel="stylesheet" href="https://www.w3.org/2019/09/TPAC-template/fonts/iconmonstr-iconic-font.css">
    <meta name="twitter:site" content="@w3c">
    <meta name="twitter:card" content="player">
    <meta property="og:title" content="Distributed multi-party media-rich content review by Oleg Sidorkin (Bluescape)">
    <meta property="og:description" content="Classic video conferencing and assets sharing tools are not adapted for group work when it comes to high fidelity content such as art, animations, video. We created a novel approach where virtually any website or web-enabled tool can gain additional functionality for live co-experience in viewing (common operating picture), commenting, and editing creative content. The desired web resource is loaded and operated in the cloud, while exact incremental changes are broadcasting to all connected clients.">
    <meta property="og:image" content="thumbnails/oleg-sidorkin-distributed-content-review.jpg">
    <meta property="og:video" content="https://iframe.videodelivery.net/ad868cc4c84ab287d1bc23410d8fa981">
    <meta property="twitter:player" content="https://iframe.videodelivery.net/ad868cc4c84ab287d1bc23410d8fa981?defaultTextTrack=en">
    <meta property="twitter:player:width" content="360">
    <meta property="twitter:player:height" content="202">
  </head>
  <body>
    <form id=form><!-- form to request a page in kiosk mode --></form>
    <header id="header" class="header">
      <div id="banner">
        <div>
          <p>
            <a href="https://www.w3.org/"><img alt="W3C" src=
            "../media/w3c_home_nb-v.svg" height="48" width="72"></a>
            <a href="https://www.smpte.org/"><img alt="SMPTE" src=
            "../media/smpte_logo.png" height="48"></a>
          </p>
          <div class="banner-title">
            <h1>
              W3C/SMPTE Joint Workshop on Professional Media Production on the Web
            </h1>
          </div>
          <p class="attribution">
            <span>Timeline photo by <a href="https://unsplash.com/@kineticbear?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Jacob Miller</a> on <a href="https://unsplash.com/s/photos/timeline?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></span>
          </p>
          <p>8-19 November 2021; online event</p>
        </div>
      </div>
      <nav class="menu" id="menu">
        <ul>
          <li><a href="../">Call for Participation</a></li>
          <li><a href="../talks.html">Pre-recorded talks</a></li>
          <li><a href="../agenda.html">Live sessions</a></li>
          <li><a href="../report.html">Report</a></li>
        </ul>
      </nav>
    </header>
    <main id="main" class="main talk">
      <section id="intro">
        <h2>Distributed multi-party media-rich content review</h2>

        <p class="talkinfo">
          Presenter: <strong>Oleg Sidorkin (Bluescape)</strong><br>
          Duration: <strong>9 minutes</strong><br>
          
        </p>

        <p class="buttons">
          <!-- previousStart -->
          <button form="form" type="submit" class="picto im-angle-left" formaction="he-zhi-production-olympics.html">
            Previous: Live and post production for Sports Broadcasting
          </button>
          <!-- previousEnd -->
          <a href="../talks.html" class="picto im-data">All talks</a>
          <!-- nextStart -->
          <button form="form" type="submit" formaction="christoph-guttandin-all-that-can-be-done.html">
            Next: Whatever can be done, will be done<span class="picto im-angle-right"></span>
          </button>
          <!-- nextEnd -->
        </p>
      </section>

      <section id="talk">
        <h3 style="display:none">Slides &amp; video</h3>

        <details>
          <summary>Keyboard shortcuts in the video player</summary>
          <ul>
            <li>Play/pause: <kbd>space</kbd>
            </li><li>Increase volume: <kbd>up arrow</kbd>
            </li><li>Decrease volume: <kbd>down arrow</kbd>
            </li><li>Seek forward: <kbd>right arrow</kbd>
            </li><li>Seek backward: <kbd>left arrow</kbd>
            </li><li>Captions on/off: <kbd>C</kbd>
            </li><li>Fullscreen on/off: <kbd>F</kbd>
            </li><li>Mute/unmute: <kbd>M</kbd>
            </li><li>Seek to 0%, 10%… 90%: <kbd>0-9</kbd>
          </li></ul>
        </details>

        <div id="player">
          <script type="application/ld+json">
            {
              "@context": "https://schema.org",
              "@type": "VideoObject",
              "name": "Distributed multi-party media-rich content review",
              "description": "Classic video conferencing and assets sharing tools are not adapted for group work when it comes to high fidelity content such as art, animations, video. We created a novel approach where virtually any website or web-enabled tool can gain additional functionality for live co-experience in viewing (common operating picture), commenting, and editing creative content. The desired web resource is loaded and operated in the cloud, while exact incremental changes are broadcasting to all connected clients.",
              "thumbnailUrl": "thumbnails/oleg-sidorkin-distributed-content-review.jpg",
              "duration": "PT9M2S",
              "embedUrl": "https://iframe.videodelivery.net/ad868cc4c84ab287d1bc23410d8fa981",
            }
          </script>

          <iframe id="video" title="Distributed multi-party media-rich content review" src="https://iframe.videodelivery.net/ad868cc4c84ab287d1bc23410d8fa981"
            allow="accelerometer; autoplay; encrypted-media; picture-in-picture"
            allowfullscreen="" width="640" height="360" frameborder="0"></iframe>

          

          <div id="slides" class="fade-in" role="region" aria-live="off" aria-label="Slide container">
            <div>
  <p id="tp-1">Hello, I'm Oleg Sidorkin. I'm a Principal Software Architect at Bluescape.</p>
  <p id="tp-2">I'm also one of the developers of co-browsing technology and that's what I'm going to be talking about today. The pandemic and the shift to remote work has challenged the collaboration work landscape all together. When previously gathering a team in one room behind a high definition screen was a no-brainer, today it has become a challenge and probably not coming back anytime soon. Classic web conferencing and asset sharing tools are not adapted for group work when it comes to high fidelity content such as art, animations, and video.</p>
  <p id="tp-3">We at Bluescape created a novel approach where virtually any web site or web enabled tool can gain additional functionality for live co-experience in viewing, commenting and editing creative content. When a user or a team starts a co-browsing session, the desired web site is loaded in the cloud while exact replicas and all incremental changes are broadcasted to all connected clients, giving them the same quality, the same latency, and about the same experience as they would browse the content on their local device or behind the same screen.</p>
  <p id="tp-4">On the server side, we use Chromium as a headless web browser thanks to its open source nature and availability of a mature Chrome DevTools Protocol (CDP). Another point to consider was 65% browser market share worldwide earned by Chrome. We selected old fashioned WebSockets as a low latency communication protocol that guarantees in-order message delivery. The challenges start when we try to capture and deliver a live and exact replica of a web page to the remote client.</p>
  <p id="tp-5">W3C DOM4 introduced MutationObserver deprecating Mutation Events. MutationObserver is a great way to get notified about changes in the DOM, but it doesn't provide enough information to understand what was the exact change and to form an incremental DOM update to be broadcasted to connected clients. We ended up with some injected JavaScript code that translates browser DOM into a virtual DOM and computes the difference between the previous and the new version of the virtual DOM. To keep cost of computation at bay, we used persistent data structures and hints from MutationObserver about each area that were affected. The immutability of virtual DOM allowed us to leverage shallow comparison via triple equal JavaScript operator so we can skip analysis of entire sub trees if we know that they will not be affected for sure.</p>
  <p id="tp-6">It works well for almost all DOM elements, but there are some exceptions to take care of. MutationObserver doesn't sense changes in canvas elements and information extraction from canvas contexts poses its own challenge. We use mixed approach. For less dynamic canvases, like charts, we extract content as data URL that becomes a special attribute in the virtual DOM so the same synchronization logic can be used as for regular elements. For canvases with highly dynamic content and specifically for WebGL ones, we have an experimental approach based on captureStream API and WebRTC video streaming.</p>
  <p id="tp-7">The document attached MutationObserver doesn't sense changes in Shadow DOM so every such shadowRoot should be observed individually, which adds additional logistics to the monitoring subsystem but it's solvable. However, additionally, Shadow DOM trees created in closed mode become invisible for JavaScript. In this case we either should give up or we can, and what we do, we monkey-patch attachShadow method of the Element to keep them open. It might contradict certain web site logic but that works.</p>
  <p id="tp-8">When we serve content of a web page to all connected clients, we have to introduce certain modifications to it. We strip out all JavaScript code, effectively making the web page passive and embeddable, so it even can bypass the iframe embed implementations. All JavaScript logic is executed in the cloud in headless browser. We patch links to external assets so all of them are served from the cloud as well. No direct access. Those are target web sites. We infuse event handlers to intercept client interactions in the page and reroute them to the cloud instance of the web site. Such interception allows us to introduce true co-browsing experience when the single instance of the web site can be effectively controlled and viewed by multiple distributed clients.</p>
  <p id="tp-9">And there are more challenges to come.</p>
  <p id="tp-10">The event handlers distinguish “trusted” events generated by user actions and synthetic events generated or modified by script or dispatched via the dispatchEvent API. This feature is effectively employed by certain web sites to ensure genuinity of the user input. The workaround we found so far is to dispatch such events through the Chrome DevTools protocol. And in this case, they become trusted events.</p>
  <p id="tp-11">Patching of external assets becomes tricky when it comes to malformed content. For example, a browser might ignore a set of errors in a CSS file and still displays the valid part while the most CSS parsing libraries in node.js ecosystem will fail to process it. The current solution that we use is to mimic the browser behavior as close as possible, effectively taking such logic, such CSS code parsing from the browser's code base, thanks to its open source nature.</p>
  <p id="tp-12">We also found that page synchronization logic is sensitive to intrusive browser extensions, that can be enabled on the client side. Some DOM changes are positional and if an extension altered the browser DOM in an unexpected way, the sync protocol might get confused. As a partial mitigation of this issue, we introduced unique identifiers to key DOM elements. JavaScript also doesn't expose object pointers and any kind of object identity, so we used a tree, we leveraged a distinguish property of a Map container where key can be any value, including DOM elements. Maintaining such a map aside allowed us to introduce unique identitiers and object pointers for DOM elements, and keep the original DOM intact without introducing interference with the Web site logic.</p>
  <p id="tp-13">Implementing co-browsers, we faced many challenges, and I described just maybe a quarter of them. A significant part is related to limitations or design decisions in corresponding web technologies. And it's understandable because what we're doing is not what you are typically doing. We are trying to implement completely remote browsing experience. For most of such issues, we managed either to find workaround or to introduce certain hacks leveraging dynamic nature of the web stack. So when it works, it works perfect, it works flawlessly. When it doesn't, finding solutions is tricky, it feels like walking through a minefield. But at the end, it's doable.</p>
  <p id="tp-14">Thank you.</p>
</div>


          </div>
        </div>
      </section>

      <section id="extrabuttons">
        <p class="buttons">
          <!-- previousStart -->
          <button form="form" id="prevtalk" type="submit" formaction="he-zhi-production-olympics.html" class="picto im-angle-left">Previous: Live and post production for Sports Broadcasting</button>
          <!-- previousEnd -->
          <a id="alltalks" href="../talks.html" class="picto im-data">All talks</a>
          <!-- nextStart -->
          <button form="form" id="nexttalk" type="submit" formaction="christoph-guttandin-all-that-can-be-done.html">Next: Whatever can be done, will be done<span class="picto im-angle-right"></span></button>
          <!-- nextEnd -->
        </p>
      </section>

      <section id="sponsors">
        <h2>
          Workshop sponsor
        </h2>
        <p><a href="https://www.adobe.com/"><img src="../media/adobe.png" alt="Adobe" width="70"></a></p>
        <p class="small">Interested in sponsoring the workshop?<br/>Please check the <a href="sponsors.html">sponsorship package</a>.</p>
      </section>
    </main>
    <footer class="footer" id="footer">
      <p>
        W3C is proud to be an open and inclusive organization, focused on
        productive discussions and actions. Our <a href=
        "https://www.w3.org/Consortium/cepc/">Code of Ethics and Professional
        Conduct</a> ensures that all voices can be heard.
      </p>
      <p>Questions? Contact François Daoust
        &lt;<a href="mailto:fd@w3.org">fd@w3.org</a>&gt;.
      </p>
      <p>
        Suggestions for improving this workshop page, such as fixing typos or
        adding specific topics, can be made by opening a <a href=
        "https://github.com/w3c/media-production-workshop/">pull request on
        GitHub</a>, or by emailing François Daoust
        &lt;<a href="mailto:fd@w3.org">fd@w3.org</a>&gt;.
      </p>
    </footer>
    <script src="../script.js"></script>
    <script>
      let captions = [
  {
    "language": "en",
    "label": "English",
    "src": "captions/oleg-sidorkin-distributed-content-review.vtt",
    "mode": "hidden",
    "cues": [],
    "activeCues": [
      {
        "text": ""
      }
    ]
  }
];
    </script>
    <script src="https://www.w3.org/2019/09/TPAC-template/parser.js"></script>
    <script src="https://embed.videodelivery.net/embed/sdk.latest.js"></script>
    <script src="../talk-sync.js"></script>
    <script src="https://w3c.github.io/i-slide/i-slide.js" type="module"></script>
  </body>
</html>
